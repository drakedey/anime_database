' Gambas class file

Public animes As JSONCollection[] = []

Public Sub btnAgregar_Click()

  FormAgregar.Show()
  FMain.Hide()
End


Public Sub Form_Open()
  cvAnimes.Columns.Count = 4
  cvAnimes.Columns[0].Text = "Nombre"
  cvAnimes.Columns[1].Text = "Capitulo"
  cvAnimes.Columns[2].Text = "AÃ±o"
  cvAnimes.Columns[3].Text = "Autor"
  readBackup("animes.json")
End

Public Sub Form_Show()
  Dim i As Integer
  Dim animeClave As String
  updateBackup("animes.json")
  cvAnimes.Clear()
  If animes.Length > 0 Then
    For i = 0 To animes.Length - 1 Step 1
      Print JSON.Encode(animes)
      animeClave = animes[i]["Name"]
      cvAnimes.Add(animeClave, animeClave)
      cvAnimes[animeClave][1] = animes[i]["Capitulo"]
      cvAnimes[animeClave][2] = animes[i]["Ano"]
      cvAnimes[animeClave][3] = animes[i]["Autor"]
    Next
  Endif
End

Public Sub readBackup(filename As String)
  Dim path As String = User.Home & "/.anime_database/" & filename
  Print "readBackup: Path: " & path
  If Exist(path) Then
    animes = JSON.Decode(File.Load(path), True)
  Endif
End


Public Sub updateBackup(filename As String)
  Dim hFileOut As File
  Dim path As String = User.Home & "/.anime_database/"
  If Not Exist(path & filename) Then
      Mkdir path
  Endif
  File.Save(path & filename, JSON.Encode(animes))
End
